<% meta_tag :title, 'Courses - Teach Computing' %>
<%= render 'components/hero', hero_title: 'Courses', glyph_position: 'bottom', colour: 'blue' %>
<div class="govuk-width-container">
  <div class="govuk-main-wrapper ncce-main-wrapper--intro">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <p class="govuk-body">We offer free professional development courses to support the teaching of computing from Key Stages 1-4.</p>
        <h2 class="govuk-heading-s">Remotely delivered courses</h2>
        <p class="govuk-body">To fully support teachers, we have developed a series of remotely delivered courses, which can be accessed from home. Each course is broken down into five hour-long sessions, delivered over the course of a week, to help you to fit your study around other commitments.</p>
        <p class="govuk-body">Please note that for remote delivered courses you will be taken to the STEM Learning website to see further details and book.</p>
        <h2 class="govuk-heading-s">Online courses</h2>
        <p class="govuk-body">Take part in any of our free online courses and learn at your own pace. Courses are hosted on FutureLearn and can be booked through our website.</p>
        <p class="govuk-body">Note: You will need to create a separate FutureLearn account to sign up for online courses. Please use the same email address as you used for your account on this site so we can track your progress.</p>
        <p class="govuk-body">Due to the widespread school closures, face-to-face courses are currently suspended, until further notice.</p>
      </div>
      <% unless current_user %>
        <div class="govuk-grid-column-one-third">
          <div class="ncce-aside">
            <h2 class="govuk-heading-m ncce-aside__title">Book courses</h2>
            <p class="govuk-body-s ncce-aside__text">
            To book onto a course, you'll need to create an account. It's free and takes two minutes!
            </p>
            <p class="govuk-body"><%= link_to 'Create an account', create_account_url, class: 'govuk-button button--aside', role: 'button', draggable: 'false' %></p>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<div class="ncce-courses__filter-container">
  <div class="govuk-width-container">
    <div class="govuk-main-wrapper ncce-courses__filter-wrapper">
      <div class="govuk-grid-row">
        <div id="filter-results" class="govuk-grid-column-full ncce-courses__filter">
          <h2 class="govuk-body-s govuk-!-font-weight-bold ncce-courses__filter-mobile-heading">
            <button aria-expanded="false">
            <svg aria-hidden="true" focusable="false" width="16px" height="10px" viewBox="0 0 160 100">
              <g transform="translate(80, 100) rotate(-135.000000)">
                  <rect width="100" height="27"></rect>
                  <rect width="27" height="100"></rect>
              </g>
            </svg>Filter courses
            </button>
          </h2>
          <%= form_tag url_for(controller: 'courses', anchor: 'filter-results'), { method: :get, class: 'ncce-courses__filter-form js-course-filter-form' } do %>
            <span class="govuk-body-m govuk-!-width-full ncce-courses__filter-prompt">Find a course:</span>
            <%= select_tag :level,
              options_for_select(@age_groups.keys, @current_level),
              {
                include_blank: 'Any level',
                class: 'govuk-select ncce-select',
                'aria-label': 'Filter by level' }
            %>
            <%= select_tag :location,
              options_for_select(@locations, @current_location),
              {
                include_blank: 'Any location',
                class: 'govuk-select ncce-select',
                'aria-label': 'Filter by location' }
            %>
            <%= select_tag :topic,
              options_for_select(@topics.keys, @current_topic),
              {
                include_blank: 'Any topic',
                class: 'govuk-select ncce-select',
                'aria-label': 'Filter by topic' }
            %>
            <%= hidden_field_tag :certificate, @current_certificate.try(:slug) %>
            <%= submit_tag "Apply filter", :name => nil, class: 'govuk-button button ncce-courses__filter-button' %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="govuk-width-container">
  <div class="govuk-main-wrapper govuk-main-wrapper--xl ncce-courses__results-wrapper">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <% if @courses.length == 0 %>
          <p class="govuk-body">No courses found that match your selection.  Please try a different one.</p>
        <% else %>
          <% @courses.each do |course| %>
            <div class="ncce-courses__course">
              <h2 id="<%= course.title %>" class="govuk-heading-s ncce-courses__heading">
                <%= link_to course.title, course_path(id: course.activity_code, name: course.title.parameterize), class: 'ncce-link' %><span class="ncce-courses__heading-code"><%= course.activity_code %></span>
              </h2>
              <p class="govuk-body"><%= stripped_summary(course.meta_description) %></p>
              <% if course.occurrences.length > 1 %>
                <h3 class="govuk-body-s govuk-!-font-weight-bold ncce-courses__locations">
                  <button aria-expanded="false">
                  <svg aria-hidden="true" focusable="false" width="16px" height="10px" viewBox="0 0 160 100">
                    <g transform="translate(80, 100) rotate(-135.000000)">
                        <rect width="100" height="27"></rect>
                        <rect width="27" height="100"></rect>
                    </g>
                  </svg>View dates & locations
                  </button>
                </h3>
              <% end %>
              <% unless course.occurrences.empty? %>
                <ul class="govuk-list govuk-body-s ncce-courses__meta">
                  <% course.occurrences.each do |oc| %>
                    <li class="govuk-grid-row ncce-courses__meta-item">
                      <span class="govuk-grid-column-one-half ncce-courses__meta-location <%= course_meta_icon_class(oc.online_cpd) %>">
                      <%= oc.address_town %></span>
                      <span class="govuk-grid-column-one-half ncce-courses__meta-date"><%= activity_times(oc.start_date, oc.end_date, oc.online_cpd) %></span>
                    </li>
                  <% end %>
                </ul>
              <% end %>
              <% unless course.subjects.nil? && course.key_stages.nil? && course.workstream.nil?%>
                <p class="govuk-body"><h3 class="screen-reader-only">Tags for this course:</h3>
                  <% course.subjects.each do |subject| %>
                    <% if @subjects.has_value?(subject.to_i) %>
                      <strong class="govuk-tag ncce-courses__tag"><%= @subjects.key(subject.to_i) %></strong>
                    <% end %>
                  <% end %>
                  <% course.age_groups.each do |group| %>
                      <% if @age_groups.has_value?(group.to_i) %>
                        <strong class="govuk-tag ncce-courses__tag"><%= @age_groups.key(group.to_i) %></strong>
                      <% end %>
                  <% end %>
                  <% if course.workstream == 'CS Accelerator' %>
                    <strong class="govuk-tag ncce-courses__tag"><%= course.workstream %></strong>
                  <% end %>
                </p>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
