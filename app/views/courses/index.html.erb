<div class="govuk-width-container">
  <div class="govuk-main-wrapper govuk-main-wrapper--xl">
    <h1 class="govuk-heading-l">Courses</h1>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column">
        <div class="govuk-grid-column-two-thirds">
          <p class="govuk-body">Please note that for face-to-face courses you will be taken to STEM Learning to see further details and book.</p>
          <p class="govuk-body">Online courses are hosted by FutureLearn. If you go through our site to book these courses will come with a free upgrade. You will need a separate FutureLearn account to sign up for them, please use the same email address as you used for your account on this site so we can track your progress.</p>
          <p class="govuk-body">After you complete the course, go to your dashboard to track your progress towards certification.</p>

          <div class="ncce-courses__filter">
            <%= form_tag :courses, { method: :get } do %>

              <span class="govuk-body-s govuk-!-width-one-quarter ncce-courses__filter-prompt">Find a course:</span>
              <%= select_tag :location,
                options_for_select(@locations, @current_location),
                { class: 'govuk-select govuk-!-width-one-quarter ncce-courses__filter-select',
                  'aria-label': 'Filter by location' }
              %>
              <%= submit_tag "Search", :name => nil %>
            <% end %>
          </div>
          <% @courses.each do |course| %>
            <div class="ncce-courses__course">
              <h2 class="govuk-heading-s ncce-courses__heading">
                <% if current_user %>
                  <%=
                    link_to_if(course.booking_url.empty?, course.title, stem_course_link(course.course_template_no), class: 'ncce-link ncce-courses__heading--link', target: :_blank) do
                      link_to(course.title, course.booking_url, class: 'ncce-link ncce-courses__heading--link', target: :_blank)
                    end
                  %>
                <% else %>
                  <%= link_to(course.title, login_path, class: 'ncce-link ncce-courses__heading--link') %>
                <% end %>
              </h2>
              <p class="govuk-body"><%= stripped_summary(course.meta_description) %></p>
              <% if course.occurrences.length > 1 %>
                <h3 class="govuk-body-s govuk-!-font-weight-bold ncce-courses__locations">
                  <button aria-expanded="false">
                  <svg aria-hidden="true" focusable="false" width="16px" height="10px" viewBox="0 0 160 100">
                    <g transform="translate(80, 100) rotate(-135.000000)">
                        <rect width="100" height="27"></rect>
                        <rect width="27" height="100"></rect>
                    </g>
                  </svg>View dates & locations
                  </button>
                </h3>
              <% end %>
              <% unless course.occurrences.empty? %>
                <ul class="govuk-list govuk-body-s ncce-courses__meta">
                  <% course.occurrences.each do |oc| %>
                    <li class="govuk-grid-row ncce-courses__meta-item">
                      <span class="govuk-grid-column-one-third <%= course_meta_css_class(oc.online_course) %>">
                      <%= oc.address_town %></span>
                      <span class="govuk-grid-column-two-thirds ncce-courses__meta-date"><%= activity_dates(oc.start_date, oc.end_date) %></span>
                    </li>
                  <% end %>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
        <% if current_user %>
        <aside class="govuk-grid-column-one-third ncce-aside">
          <h2 class="govuk-heading-s ncce-aside__title">Diagnostic Tool</h2>
          <p class="govuk-body-s ncce-aside__text">Need help finding a course that's suitable for you? Use our diagnostic tool to identify the areas of subject
          knowledge where you need most support.</p>
          <p class="govuk-body-s"><%= link_to 'Use Diagnostic Tool', activities_download_path(Activity.downloaded_diagnostic_tool.id, :file => { name: 'NCCE.Diagnostic.pdf' }), class: 'govuk-button ncce-button__pink ncce-aside__button', role: 'button', draggable: 'false', target: :_blank %></p>
        </aside>
        <% else %>
        <aside class="govuk-grid-column-one-third ncce-aside">
          <h2 class="govuk-heading-s ncce-aside__title">Book courses</h2>
          <p class="govuk-body-s ncce-aside__text">
          To book onto a course, you'll need to create an account. It's free and takes two minutes!
          </p>
          <p class="govuk-body-z">
            <%= link_to 'Create an account / log in', login_path,
            class: 'govuk-button ncce-button__pink ncce-aside__button',
              role: 'button', draggable: 'false' %>
          </p>
        </aside>
        <% end %>
      </div>
    </div>
  </div>
</div>
