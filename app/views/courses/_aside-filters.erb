<% unless @course_filter.nil? %>
<div class="ncce-aside ncce-aside--filters" data-action="resize@window->course-filter#openFilterFormOnDesktop resize@window->course-filter#scrollToTop" data-course-filter-target="filterFormHeader">
  <h2 class="govuk-body-m ncce-aside__title ncce-aside--filters__title">Filter courses</h2>
  <button type="button" class="ncce-courses__filter-form-toggle--open" data-course-filter-target="filterFormToggle" data-action="click->course-filter#toggleFilterForm">
    <span class="ncce-courses__filter-form-toggle-applied <%= filter_count(@course_filter) == 0 ? 'hidden' : '' %>" data-course-filter-target="filterCount"><%= applied_filters_string(@course_filter) %> applied</span>
    Filter courses
  </button>
  <div class="ncce-courses__filter" data-course-filter-target="filterForm">
    <div class='ncce-courses__clear-filters <%= filter_count(@course_filter) == 0 ? 'hidden' : '' %>' data-course-filter-target="clearFilters">
      <%= link_to 'Clear all filters', courses_path(hub_id: @filter_params[:hub_id], anchor: 'results-top'), class: 'govuk-button button button--small govuk-body-m', data: { action: 'click->course-filter#clearFilters' } %>
    </div>
    <%= form_with url: course_filter_path, method: :get, class: 'ncce-courses__filter-form', data: { action: "ajax:success->course-filter#handleResults", 'course-filter-target': "form" } do %>
      <%= label_tag :level, 'Key Stage:', class: 'govuk-body-s ncce-label' %>
      <%= select_tag :level,
        options_for_select(@course_filter.age_groups.keys, @course_filter.current_level),
        {
          include_blank: 'Any level',
          class: "govuk-select ncce-select ncce-select--filters #{@course_filter.current_level ? 'filter--active' : ''}",
          'aria-label': 'Filter by level',
          data: { action: "input->course-filter#filter input->course-filter#toggleActiveSelect" }
        }
      %>
      <%= label_tag :level, 'Topic:', class: 'govuk-body-s ncce-label' %>
      <%= select_tag :topic,
        options_for_select(@course_filter.course_tags.keys, @course_filter.current_topic),
        {
          include_blank: 'Any topic',
          class: "govuk-select ncce-select ncce-select--filters #{@course_filter.current_topic ? 'filter--active' : ''}",
          'aria-label': 'Filter by topic',
          data: { action: "input->course-filter#filter input->course-filter#toggleActiveSelect" }
        }
      %>
      <%= label_tag :certificate, 'Certificate:', class: 'govuk-body-s ncce-label' %>
      <%= select_tag :certificate,
        options_for_select(@course_filter.certificates, @course_filter.current_certificate),
        {
          include_blank: 'Any certificate',
          class: "govuk-select ncce-select ncce-select--filters #{@course_filter.current_certificate ? 'filter--active' : ''}",
          'aria-label': 'Filter by certificate',
          data: { action: "input->course-filter#filter input->course-filter#toggleActiveSelect" }
        }
      %>
      <%= label_tag :location, 'Location:', class: 'govuk-body-s ncce-label' %>
      <%= select_tag :location,
        options_for_select(@course_filter.course_locations, @course_filter.current_location),
          {
            include_blank: 'Any location',
            class: "govuk-select ncce-select ncce-select--filters #{@course_filter.current_location ? 'filter--active' : ''}",
            'aria-label': 'Filter by location',
            data: { action: "input->course-filter#filter input->course-filter#toggleActiveSelect" }
          }
      %>
      <%= label_tag :format, 'Course format:', class: 'govuk-body-s ncce-label' %>
      <div class="govuk-checkboxes">
      <% @course_filter.course_formats.each_with_index do |course_format, index| %>
        <div class='govuk-checkboxes__item ncce-checkboxes__item'>
          <%= check_box_tag 'course_format[]', course_format, @course_filter&.current_format&.include?(course_format.to_s), class: 'govuk-checkboxes__input ncce-checkboxes__input', data: { action: 'input->course-filter#filter  input->course-filter#toggleActiveCheckbox', 'aria-label': 'Filter by format' }, id: "course_format_#{index}" %>
          <%= label_tag "course_format_#{index}", (course_format.to_s).humanize, class: 'govuk-label govuk-checkboxes__label ncce-label ncce-checkboxes__label' %>
        </div>
      <% end %>
      </div>
      <%= hidden_field_tag 'hub_id', @course_filter.current_hub %>
      <%= hidden_field_tag 'js_enabled', false %>

      <%= submit_tag "Apply filters", :name => nil, class: 'govuk-button button ncce-courses__filter-button ncce-courses__apply-filters-button' %>
    <% end %>
    <button type="button" class="govuk-button button ncce-courses__view-results" data-action="click->course-filter#closeFilterForm" data-course-filter-target="viewResultsCount">View <%= pluralize(@course_filter.courses.size, 'result') %></button>
  </div>
</div>
<% end %>
